# VAAPI GPU docker-compose for Intel/AMD GPU transcoding
#
# Maps the DRI device into the container for VAAPI hardware encoding.

services:
  rustfin:
    build: .
    container_name: rustfin-vaapi
    ports:
      - "8096:8096"
    extra_hosts:
      - "host.docker.internal:host-gateway"
    volumes:
      - rustfin-config:/config
      - rustfin-cache:/cache
      - rustfin-transcode:/transcode
      - ${RUSTFIN_MEDIA_PATH:-/Users/iwanteague/Media}:/media:ro
    devices:
      - /dev/dri:/dev/dri
    environment:
      - RUSTFIN_ADMIN_PASSWORD=changeme
      - RUST_LOG=info
      - RUSTFIN_DIRECTORY_PICKER_HELPER_URL=${RUSTFIN_DIRECTORY_PICKER_HELPER_URL:-http://host.docker.internal:43110/pick}
      - RUSTFIN_MEDIA_HOST_PATH=${RUSTFIN_MEDIA_PATH:-/Users/iwanteague/Media}
      - RUSTFIN_MEDIA_CONTAINER_ROOT=/media
    restart: unless-stopped

volumes:
  rustfin-config:
  rustfin-cache:
  rustfin-transcode:
